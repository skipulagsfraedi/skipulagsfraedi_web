---
import Layout from '../../../../../layouts/Layout.astro';
import {getAllNews, toPlainText} from '../../../../../lib/news';
import type {NewsPost} from '../../../../../lib/news';
import {portableTextToHtml} from '../../../../../lib/portableText';

export async function getStaticPaths() {
	const posts = await getAllNews();
	return posts.map((post) => {
		const date = new Date(post.publishedAt);
		const year = date.getUTCFullYear().toString();
		const month = String(date.getUTCMonth() + 1).padStart(2, '0');
		const day = String(date.getUTCDate()).padStart(2, '0');
		return {
			params: {year, month, day, slug: post.slug},
			props: {post},
		};
	});
}

const {post} = Astro.props as {post: NewsPost};

const pageTitle = `${post.title} | Fréttir | Skipulagsfræðingafélag Íslands`;
const pageDescription = toPlainText(post.content).slice(0, 160);

const formattedDate = new Date(post.publishedAt).toLocaleDateString('is-IS', {
	year: 'numeric',
	month: 'long',
	day: 'numeric',
});

const htmlContent = portableTextToHtml(post.content);
---

<Layout title={pageTitle} description={pageDescription}>
	<article class="mx-auto w-full max-w-3xl px-6 py-16">
		<p class="text-xs font-semibold uppercase tracking-[0.35em] text-slate-500">Frétt</p>
		<h1 class="mt-4 text-4xl font-semibold leading-tight text-slate-900 sm:text-5xl">
			{post.title}
		</h1>
		<p class="mt-4 text-sm uppercase tracking-[0.25em] text-slate-400">{formattedDate}</p>
		<div class="mt-10 space-y-6 text-base leading-relaxed text-slate-700">
			<div set:html={htmlContent} />
		</div>
		<a
			href="/frettir"
			class="mt-12 inline-flex items-center gap-2 text-sm font-semibold text-[#4d5c55]"
		>
			&lt; Til baka í fréttir
		</a>
	</article>
</Layout>
